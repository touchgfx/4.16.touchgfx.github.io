<!doctype html>
<html lang="zh-TW" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/touchgfx-hal-development/touchgfx-generator">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.16/zh-TW/opensearch.xml">
<script src="/4.16/js/fix-location.js"></script><title data-rh="true">Generator使用者指南 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.16/zh-TW/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.16/zh-TW/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator"><meta data-rh="true" name="docusaurus_locale" content="zh-TW"><meta data-rh="true" name="docsearch:language" content="zh-TW"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Generator使用者指南 | TouchGFX Documentation"><meta data-rh="true" name="description" content="TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是CubeMX附加軟體元件，可幫助開發人員配置TouchGFX讓應用可在開發者的硬體平台上執行。 根據現有的CubeMX設定與使用者的輸入，TouchGFX Generator將產生用以配置一個可運作的TouchGFX應用所需的所有檔案， 包含了TouchGFX HAL、TouchGFX OSAL和TouchGFX配置檔。"><meta data-rh="true" property="og:description" content="TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是CubeMX附加軟體元件，可幫助開發人員配置TouchGFX讓應用可在開發者的硬體平台上執行。 根據現有的CubeMX設定與使用者的輸入，TouchGFX Generator將產生用以配置一個可運作的TouchGFX應用所需的所有檔案， 包含了TouchGFX HAL、TouchGFX OSAL和TouchGFX配置檔。"><link data-rh="true" rel="icon" href="/4.16/zh-TW/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/ko/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/ja/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.16/zh-TW/assets/css/styles.ec0ff9ef.css">
<link rel="preload" href="/4.16/zh-TW/assets/js/runtime~main.eee51835.js" as="script">
<link rel="preload" href="/4.16/zh-TW/assets/js/main.3ffa3542.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.16/zh-TW/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.16/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.16/zh-TW/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">繁體中文</a><ul class="dropdown__menu"><li><a href="/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.16/ko/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.16/ja/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">简体中文</a></li><li><a href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.16/zh-TW/docs/introduction/welcome">4.16</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator">4.16</a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><div class="searchBox_Gz_y"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到頂部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/introduction/welcome">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/basic-concepts/embedded-graphics">Basic Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/4.16/zh-TW/docs/development/development-introduction">Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-TW/docs/development/development-introduction">開發簡介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-TW/docs/development/hardware-selection/hardware-selection-introduction">Hardware Selection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-TW/docs/development/board-bring-up/board-introduction">Board Bring Up</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL 開發簡介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-architecture">抽象層架構</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator">Generator使用者指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">Scenarios</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-TW/docs/development/ui-development/ui-development-introduction">UI Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-TW/docs/development/scenarios/touchgfx-on-lowcost-hardware">Scenarios</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/miscellaneous/updating-to-a-new-touchgfx-version">Miscellaneous</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/tutorials/tutorial-01">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-TW/docs/resources/presentations">Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="頁面路徑"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TouchGFX AL Development</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Generator使用者指南</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本頁導覽</button></div><div class="theme-doc-markdown markdown"><header><h1>Generator使用者指南</h1></header><p>TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是CubeMX附加軟體元件，可幫助開發人員配置TouchGFX讓應用可在開發者的硬體平台上執行。 根據現有的CubeMX設定與使用者的輸入，TouchGFX Generator將產生用以配置一個可運作的TouchGFX應用所需的所有檔案， 包含了TouchGFX HAL、TouchGFX OSAL和TouchGFX配置檔。</p><p>以CubeMX產生程式碼後，可透過用來開發UI的TouchGFX Designer來打開TouchGFX專案。 TouchGFX Designer會自動將所有額外產生的程式碼檔案加入CubeMX所指定的目標IDE當中。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-touchgfx-generator">啟用TouchGFX Generator<a class="hash-link" href="#enabling-touchgfx-generator" title="Direct link to heading">​</a></h2><p>下圖可看到在<em>附加軟體（Additional Software）</em>分類（Categories）展開項目中TouchGFX Generator已被啟用的專案。 使用者可透過按「附加軟體（Additional Software）」按鈕來存取X-CUBE以新增功能。</p><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/enable-generator.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/enable-generator.webp"></a><p>在CubeMX中選擇附加軟體（Additional Software）</p></div><p>下圖展示在專案中如何啟用TouchGFX Generator：</p><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/add-generator.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/add-generator.webp"></a><p>啟用TouchGFX Generator</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-code-architecture">產生程式碼的架構<a class="hash-link" href="#generated-code-architecture" title="Direct link to heading">​</a></h2><p>在描述TouchGFX Generator的功能之前，先了解所產生程式碼的架構以及開發人員如何使用該架構來客製化配置和行為至關重要。</p><p>要保護由CubeMX所產生的C程式碼中所加入的使用者程式碼，就必需將使用者程式碼置於<strong>「使用者程式碼（User Code）」程式碼區段</strong>當中。在TouchGFX Generator所產生的C++程式碼中，這樣的靈活性是透過物件繼承的方式來實現。</p><p>透過<em>附加軟體（Additional Software）</em>新增並啟用TouchGFX Generator之後，CubeMX會一直為專案建立一個<em>TouchGFX</em>資料夾。 無論配置如何，該資料夾總是包含相同的檔案成員，而檔案內容則因CubeMX和使用者配置而異。</p><p>由以下的清單可看到<em>啟用</em>TouchGFX Generator之後的CubeMX專案內容，並列出與TouchGFX相關較完整的檔案成員。 在清單之後的表格則列出了最重要項目的職責（responsibility）。</p><div class="code-header"><div><h5>TouchGFX Folder</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   .mxproject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   myproject.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Drivers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───EWARM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Middlewares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└───TouchGFX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ApplicationTemplate.touchgfx.part</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├───App</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └───target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXGPIO.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        └───generated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                OSWrappers.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXConfiguration.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.hpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>資料夾</th><th>職責（Responsibility）</th></tr></thead><tbody><tr><td>myproject.ioc</td><td>CubeMX專案檔</td></tr><tr><td>Core</td><td><code>main.c</code>與啟動程式碼（startup code）</td></tr><tr><td>Drivers</td><td>CMSIS與MCU系列驅動程式</td></tr><tr><td>EWARM</td><td>IDE專案資料夾。 可以為EWARM，MDK-ARM或STM32CubeIDE</td></tr><tr><td>Middlewares</td><td>包含TouchGFX函式庫/標頭檔以及FreeRTOS等第三方軟體。</td></tr><tr><td>ApplicationTemplate.touchgfx.part</td><td>CubeMX使用與TouchGFX Designer專案相關的資訊（如螢幕尺寸和位元深度）來更新.part檔案</td></tr><tr><td>App</td><td>為X-CUBE和CubeMX的介面。 <code>app_touchgfx.c</code>包含了用於初始化TouchGFX並啟動其主迴圈的<code>MX_TouchGFX_Process (void)</code>和<code>MX_TouchGFX_Init (void) </code>二個函式的定義。</td></tr><tr><td>target/generated</td><td>該子資料夾包含唯讀檔，當配置更改時，這些唯讀檔會被CubeMX所覆蓋。 <code>TouchGFXGeneratedHAL.cpp</code>是TouchGFX的<code>HAL</code>物件類別的子類別，包含了CubeMX根據目前的設定所產生的程式碼。 <code>OSWrappers.cpp</code>（OSAL）包含與TouchGFX引擎同步所需的函式。最後是<code>TouchGFXConfiguration.cpp</code>，包含了用來建構和設定TouchGFX（包括HAL）的程式碼。</td></tr><tr><td>target</td><td>包含大量的檔案，使用者可修改這些檔案以擴展HAL行為，或者修改檔案以覆蓋由CubeMX產生的配置。 <code>STM32TouchController.cpp</code>包含了觸控控制器操作的空介面。 <code>TouchGFXHAL.cpp</code>定義了<code>TouchGFXGeneratedHAL</code>的物件子類別<code>TouchGFXHAL</code>。</td></tr></tbody></table><p>需要注意的是<code>TouchGFXConfiguration.cpp</code>包含了一個用來建構HAL的函式， 以及一個用於啟動TouchGFX主迴圈的函式。 在可編輯的使用者類別<code>TouchGFXHAL</code>當中可以新增附加的配置。 HAL的一般架構如下所示 ：</p><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/code-architecture.webp" target="_blank"><img width="200" src="/4.16/zh-TW/img/development/touchgfx-hal-development/code-architecture.webp"></a><p>產生的程式碼之階層結構</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">特性概述<a class="hash-link" href="#feature-overview" title="Direct link to heading">​</a></h2><p>啟用TouchGFX Generator之後在使用者介面可看到三個設定項目群組：</p><ul><li><strong><em>相依關係（Dependencies）</em></strong> - 此設定項目群組用來通知開發人員包含配置中的相依關係、警告或具體錯誤的訊息。 若沒有條目則該項目群組將隱藏。</li><li><strong><em>顯示（Display）</em></strong> - 此設定項目群組包含與顯示有關的配置如介面、影像緩衝區的位元深度、寬度和高度。 這些配置會直接影響TouchGFX專案裡畫布（canvas）的大小以及根據圖源資產（asset）所產生的程式碼。</li><li><strong><em>驅動程式（Driver）</em></strong> - 此設定項目群組允許使用者選擇與應用相關的時標源（tick source）、圖形加速和RTOS有關的一些現成驅動程式。 由於CubeMX支援FreeRTOS（CMSIS RTOS v1與v2）的配置設定，TouchGFX Generator可為每個選項提供驅動程式。</li></ul><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/three-sections.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/three-sections.webp"></a><p>TouchGFX Generator有三個設定項目群組：相依關係、顯示、驅動程式</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="display">顯示（Display）<a class="hash-link" href="#display" title="Direct link to heading">​</a></h2><p><em>顯示（Display）</em>設定項目群組群組包含與顯示有關的配置，如介面、尺寸和緩衝區使用策略。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interface-and-dimensions">介面與尺寸<a class="hash-link" href="#interface-and-dimensions" title="Direct link to heading">​</a></h3><p>目前STM32微控制器可使用多種顯示介面，如：</p><ul><li>並行式RGB</li><li>MIPI DSI</li><li>FMC</li><li>SPI</li></ul><p>對於帶有LTDC的MCU來說，<em>TouchGFX Generator</em> 可產生驅動程式來將影像緩衝區的內容傳輸到相連的顯示器。 而對於DSI、FMC和SPI介面來說，驅動程式必須由開發人員自行實作。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有關不同顯示介面的驅動程式的具體範例請參閱<a href="/4.16/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">使用情境（Scenarios）</a>章節。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffering-strategies">緩衝區策略<a class="hash-link" href="#buffering-strategies" title="Direct link to heading">​</a></h3><p>可透過TouchGFX Generator設定以下影像緩衝區策略：</p><ul><li><strong>單一影像緩衝區</strong> - 僅使用一個應用影像緩衝區。 性能可能會受限，但記憶體用量較少。 可與「緩衝區位置（Buffer Location）」的配置一起使用以將其放置在內部RAM當中。 若需更進一步的最佳化，使用者可以定義一個函式來回傳顯示控制器當前正在處理的「行（current line）」。 框架可使用該方法在該圖框當中對內容已被傳輸到顯示器的記憶體作更新。</li><li><strong>雙影像緩衝區</strong> - 使用兩個影像緩衝區。 通常是指以更大的記憶體用量為代價來換取更好的性能。</li><li><strong>局部緩衝區</strong> - 將一個或多個由使用者定義的記憶體區塊作為影像緩衝區。 此策略適用於不依賴外部RAM但所使用連接的顯示器其全部完整的影像緩衝區卻超過內部可用記憶體這類型低成本的方案。</li></ul><p>對單一緩衝區與雙緩衝區來說，使用者可透過「緩衝器位置（Buffer Location）」來設定其記憶體位置，此設定提供以下選項：</p><ul><li><strong>依配置（By Allocation）</strong> - 允許連結器根據連結器設定檔來放置影像緩衝記憶體。 預設選項為置於內部RAM（internal RAM）中。</li><li><strong>依位址（By Address）</strong> - 允許使用者定義一個（單）或兩個（雙）影像緩衝區位址。</li></ul><p><strong>局部緩衝區</strong>策略允許使用者定義以下參數：</p><ul><li>區塊數量（始終放置在內部RAM中）</li><li>區塊大小（位元組數）</li></ul><p>要了解有關局部緩衝策略的一些核心概念，請閱讀關於「使用局部影像緩衝區以降低記憶體用量」的<a href="/4.16/zh-TW/docs/development/scenarios/lowering-memory-usage-with-partial-framebuffer">專文</a> 此專文從概念上說明了如何實現局部緩衝區，而要稍微留意的是在專文中所展示的程式碼會與TouchGFX Generator所產生的程式碼略有不同。 有關為這些策略而產生的具體程式碼範例，請參見<a href="/4.16/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-framebuffer-strategies">影像緩衝策略</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="driver">驅動程式<a class="hash-link" href="#driver" title="Direct link to heading">​</a></h2><p>這個驅動程式的設定項目群組讓開發人員可以為TouchGFX AL的各種功能選擇驅動程式。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-tick-source">應用時標源（Application Tick Source）<a class="hash-link" href="#application-tick-source" title="Direct link to heading">​</a></h3><p>應用時標源定義了應用程式的運作進行方式。 開發人員有以下的選項：</p><ul><li><strong>LTDC</strong> - 如果在「顯示（Display）」的設定項目群組當中將介面（Interface）設為「LTDC」，則應用時標源即可設定為「LTDC」。 這表示TouchGFX Generator將在<code>TouchGFXGeneratedHAL</code>物件類別當中置入驅動函式（LTDC中斷處理程式）並在此驅動函式當中透過呼叫<code>OSWrappers::signalVSync()</code>來驅使應用程式的運作。</li><li><strong>客製化</strong> &gt; - 在這種情況下，開發人員需要自行實作一個處理函式（handler）以便透過重複呼叫<code>OSWrappers::signalVSync()</code>來驅使應用程式的運作。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphics-accelerator">圖形加速器<a class="hash-link" href="#graphics-accelerator" title="Direct link to heading">​</a></h3><p>關於圖形加速開發人員有三個選項：</p><ul><li><strong>無</strong> - 應用程式僅使用CPU來繪製圖框（frames）。</li><li><strong>Chrom-ART (DMA2D)</strong> - 應用程式在可以使用Chrom-ART的情況下使用Chrom-ART來移動和混合像以釋放CPU資源。 驅動程式由TouchGFX Generator安裝因此開發人員不需要做任何處置。</li></ul><p>TouchGFX Generator提供的Chrom-ART （DMA2D） 驅動程式支援兩種TransferCompleteInterrupt的處理方式：</p><ol><li>使用STM32Cube HAL驅動程式，其中回呼函式（callback function）註冊到dma2d的控制代碼（handle）<code>hdma2d. XferCpltCallback</code>。</li><li>直接使用中斷處理程式<code>DMA2D_IRQHandler ()</code>。</li></ol><p>在CubeMX藉由開啟或關閉DMA2D IP配置NVIC Setting分頁裡的DMA2D全域中斷，便可以在這兩種方式之間作切換。 開啟全域中斷可以產生選項1的程式碼，關閉全域中斷可以產生選項2的程式碼。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>開啟使用DMA2D的全域中斷時請確保「IRQ處理函式」會呼叫DMA2D HAL處理函式，這是預設的行為。</li><li>如果在啟用全域中斷的同時閉閉DMA2D的「IRQ處理函式」和「HAL處理函式的呼叫」將導致註冊的回呼函式永遠不會被呼叫。</li></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-operating-system">即時作業系統<a class="hash-link" href="#real-time-operating-system" title="Direct link to heading">​</a></h3><p>開發人員可在TouchGFX使用任何的RTOS（甚至不使用作業系統）。 如「抽象層架構（Abstration Layer Architecture）」中所述，依據使用者所選的RTOS，TouchGFX引擎使用<code>OSWrappers</code>介面來同步TouchGFX引擎的主要事件迴圈和影像緩衝區之間的存取。</p><p>在CubeMX當中可以接設定FreeRTOS，而TouchGFX Generator讓使用者同時為「RTOS任務的定義」和「TouchGFX RTOS驅動程式 」產生程式碼。 TouchGFX Generator可產生相容CMSIS V1和CMSIS V2的RTOS驅動程式以相容任何的CMSIS RTOS。 在這種情況下，開發人員無法依賴CubeMX產生RTOS任務定義的程式碼而必須在<em>使用者程式碼</em>中完成。</p><p>下圖顯示了透過TouchGFX Generator可用的選項。</p><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options.webp" target="_blank"><img width="675" src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options.webp"></a><p>RTOS驅動程式選項</p></div><p>呼叫以下函式即進入TouchGFX主迴圈。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>開發者需要在執行TouchGFX任務的處理函式（task handler）當中呼叫此函式。 如果使用者在CubeMX配置了名為<code>DefaultTask</code>的FeeRTOS任務，則可由以下範例看到如何在此任務處理程式的使用者程式區段（user code section）中藉由呼叫<code>MX_TouchGFX_Process() </code>來啟動TouchGFX。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">StartDefaultTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 5 */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 5 */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>啟用FreeRTOS之後CubeMX還會產生<code>osKernelStart()</code>的呼叫以啟動排程器（scheduler）。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-cmsis-compliant-os">其他CMSIS相容的OS<a class="hash-link" href="#other-cmsis-compliant-os" title="Direct link to heading">​</a></h4><p>當開發人員不使用CubeMX所提供的FreeRTOS而要採用其他CMSIS相容的即時作業系統時就必須自行手動完成RTOS配置和任務定義。 通常需要以下步驟：</p><ol><li>設定RTOS</li><li>定義用來執行TouchGFX的任務（以便在其中呼叫<code>MX_TouchGFX_Process</code>）</li><li>啟動排程器（scheduler）</li></ol><p>以下是如何對<em>Azure RTOS</em>執行步驟2和3的範例。 由於CubeMX無法為此作任何配置，因此必須在產生的<em>使用者程式碼區段（User Code Sections）</em>中執行所有操作以避免自行新增的程式碼被覆蓋。 以下為GUI任務函式定義實作的虛擬程式碼（pseudo code）。 任何不是由CubeMX產生的程式碼通常都要分散置於<code>main.c</code>程式檔當中的<em>使用者程式碼區段（User Code Sections）</em>。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;tx_api.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">GUI_THREAD_STACK_SIZE</span><span class="token macro property">         </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TX_THREAD gui_thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ULONG thread_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Thread prototype</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION - Choose an appropriate one from main.c */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Allocate the stack for gui thread  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_allocate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Create the gui thread.  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">tx_thread_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">gui_thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GUI Thread&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> GUI_TASK_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_NO_TIME_SLICE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_AUTO_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>於任務處理函式當中呼叫<code>MX_TouchGFX_Process</code>以啟動TouchGFX引擎主迴圈。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ULONG thread_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>啟動排程器以啟動GUI任務及TouchGFX應用。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">tx_kernel_enter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-features">額外功能<a class="hash-link" href="#additional-features" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-data-reader">外部資料讀取器<a class="hash-link" href="#external-data-reader" title="Direct link to heading">​</a></h4><p>對於RGB565影像緩衝像素格式，TouchGFX支援所謂的<em>資料讀取器（Data Reader）</em>介面，讓開發者能夠直接從非記憶體映射（non-memory-mapped）的序列式快閃記憶體（serial flash）讀取資料，而無需進行<a href="/4.16/zh-TW/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">暫存（caching）</a>，當然這需要增加額外的緩衝儲存區。 有關如何實作DataReader以便由非記憶體映射（non-memory-mapped）的快閃記憶體當中獲取應用程式圖資（asset）的範例請參見<a href="/4.16/zh-TW/docs/development/scenarios/using-serial-flash">Serial Flash</a>文章。</p><p><em>資料讀取器（Data Reader）</em>選項通常適用在如STM32G0這一類沒有足夠的記憶體用於額外緩衝區的低成本解決方案。 在啟用DMA2D之後便無法啟用這個選項。</p><p>將影像緩衝像素格式（Framebuffer Pixel Format）設為<em>RGB565</em>之後便可看到新增了<em>附加功能（Additional Features）</em>設定項群組。</p><div class="figure noshadow"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.webp" target="_blank"><img width="520" src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.webp"></a><p>額外功能: 資料讀取器（Data Reader）</p></div><p>開發人員可進行以下設定：</p><ul><li><strong>外部資料讀取器</strong>：以來啟用或關閉功能。 如果啟用，TouchGFX會直接透過所產生的介面獲取圖資（assets）。 如果功能關閉，則開發者需要將影像<em>暫存（cache）</em>到記憶體緩衝區中。</li><li><strong>外部資料讀取器</strong>：建立兩個緩衝區以便將影像或文字混合到影像緩衝區當中。 預設值為一個螢幕寬度乘上4位元組以支援ARGB8888像素格式的全尺寸影像。</li><li><strong>最小DMA傳輸量</strong>：設定啟動DMA傳輸所需的最小位元組。 如果請求的傳輸量少於最小位元組便不會用到DMA。</li></ul><p>在啟用<em>外部資料讀取器（External Data Reader）</em>的情況下產生程式碼會建立如下的附加檔案以利直接從非記憶體映射（non-memory-mapped）的快閃記憶體中獲取圖資（asset）。</p><ul><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.hpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.cpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.hpp</code></li></ul><p>像往常一樣，TouchGFX Generator產生的程式碼<code>TouchGFXGeneratedDataReader</code>為唯讀，使用者的修改應該要在<code>TouchGFXDataReader</code>物件類別中進行。 而<code>TouchGFXGeneratedDataReader</code>繼承自<code>touchgfx::FlashDataReader </code>物件類別 。</p><p>TouchGFX Generator會修改以下檔案來配置TouchGFX HAL以使用<code>DataReader</code>。</p><ul><li><code>TouchGFX/target/generated/TouchGFXConfiguration.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.hpp</code></li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">只有在同時關閉DMA2D與LTDC的情況之下才可使用DataReader附加功能。</div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8bit-ltdc-color-look-up-table">8位元 LTDC顏色查找表（Look-up Table）<a class="hash-link" href="#8bit-ltdc-color-look-up-table" title="Direct link to heading">​</a></h4><p>當LTDC設定為以L8的格式讀取影像緩衝區，並且TouchGFX以<!-- -->[ABRG2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp<strong><em>a_b_g_r2222), <!-- -->[ARGB222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp</em></strong>a_r_g_b2222), <!-- -->[BGRA2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp<strong><em>b_g_r_a2222)， 或<!-- -->[RGBA2222]<!-- -->(.. /.. /api/classes/classtouchgfx_1_1_l_c_d8bpp</em></strong>r_g_b_a2222)的方式作渲染算圖時，TouchGFX Generator將提供CLUT，並在<code>TouchGFXHAL::initialize()</code>期間將該CLUT載入到LTDC中。 有關LTDC和CLUT的用法，詳見STM32 MCU參考手冊。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-project">產生的專案<a class="hash-link" href="#generated-project" title="Direct link to heading">​</a></h2><p>使用CubeMX中的<strong>產生程式碼（Generate Code）</strong>按鈕產生程式碼時可產生以下IDE的TouchGFX專案檔：</p><ol><li>EWARM</li><li>MDK-ARM</li><li>STM32CubeIDE</li></ol><p>藉由選取以下與專案產生相關的選項可以得到較佳的專案目錄結構：</p><ul><li>應用結構：<strong>進階</strong></li><li>關閉 <strong>Generate under root</strong>（僅適用於STM32CubeIDE）</li></ul><p>藉由選取以下與專案產生相關的選項可以得到較佳的專案目錄結構：</p><ul><li>應用結構：<strong>進階</strong></li><li>關閉 <strong>Generate under root</strong>（僅適用於STM32CubeIDE）</li></ul><div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.webp"></a><p>選取「進階的應用程式結構（Advanced application structure）」並取消選取「Generate under root」</p></div> CubeMX還會產生具有以下目錄結構的*TouchGFX*資料夾：<div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.webp"></a><p>TouchGFX資料夾結構</p></div><ul><li><em>應用</em>資料夾包含用於初始化和啟動TouchGFX的程式碼。</li><li><em>target</em>資料夾包含產生的唯讀程式檔（置於generated/目錄中）和可修改的使用者物件類別檔（<code>STM32TouchController.cpp</code> ，<code>TouchGFXGPIO.cpp</code>和<code>TouchGFXHAL.cpp</code>）</li><li><em>.part</em>檔案，使用TouchGFX Designer來開啟以建立完整的TouchGFX專案（包括TouchFX的標頭檔和函式庫）。part檔案包含為了產生TouchGFX應用程式碼設計人員需使用的相關程式資訊（如像素格式與畫布尺寸）。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-designer-project">TouchGFX Designer專案<a class="hash-link" href="#touchgfx-designer-project" title="Direct link to heading">​</a></h2><p>以下程式碼是在<a href="#generated-code-architecture">產生程式碼的架構（Generated Code Architecture）</a>章節當中提及的<code>.part</code>檔案內容的範例。 當TouchGFX Designer建立新檔案（如新螢幕與圖資）時，後置產生指令（post-generate command，如下所示 ）會更新CubeMX中選擇的專案（如EWARM ）。</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Application&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my_project&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;TouchGfxPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableColorDepths&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableLCDs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;16&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LCD16bpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableResolutions&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Width&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">320</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Height&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">240</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;PostGenerateTargetCommand&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;touchgfx update_project --project-file=../my_project.ioc --platform=m7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;4.13.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用TouchGFX Designer開啟<em>.part</em>檔案時，開發人員可以選擇載入具體實際的UI或從空白範本開始。</p><div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui.webp"></a><p>選擇UI</p></div><p>按下TouchGFX Designer當中的<em>產生代碼（Generate Code）</em>之後可得到如下的TouchGFX資料夾結構。 由下圖可看到TouchGFX資料夾結構的具體範例，當中以高亮度強調了產生後的新檔案及資料夾。</p><div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code.webp"></a><p>產生程式碼</p></div><div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.webp"></a><p>TouchGFX資料夾結構</p></div><p>TouchGFX將從CubeMX的.ioc檔當中偵測所選取的IDE（STM32CubeIDE，EWARM，MDK-ARM），並使用新生成的檔案（如用於螢幕定義、圖像和字型的圖資）來更新專案檔。</p><p>此時，開發人員可以交互使用CubeMX，TouchGFX Designer和工具鏈/IDE，其中：</p><ul><li>CubeMX可以更新IDE專案中的驅動程式</li><li>CubeMX根據UI相關變更來更新TouchGFX <em>.part</em>檔案，而設計工具（designer）可同時立即取得這些變更</li><li>CubeMX根據TouchGFX與平台相關的TouchGFX Generator配置來產生HAL程式碼（TouchGFX/target/generated/）。</li><li>TouchGFX Designer使用產生的程式碼來更新專案。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-generated-behavior">修改所產生的行為<a class="hash-link" href="#modifying-generated-behavior" title="Direct link to heading">​</a></h2><p>需要注意的是，HAL的物件類別階層結構讓使用者可以覆寫（override）CubeMX所產生的HAL配置或行為（behavior）。 在以下範例中，開發人員可以修改<code>initialize</code>函式對TouchGFX作額外的配置，或修改<code>TouchGFXGeneratedHAL</code>當中現有的配置集組。</p><div class="code-header"><div><h5>TouchGFXHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling parent implementation of initialize().</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// To overwrite the generated implementation, omit call to parent function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and implemented needed functionality here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Please note, HAL::initialize() must be called to initialize the framework.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Overriding configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lockDMAToFrontPorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setFingerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-projects">升級專案<a class="hash-link" href="#upgrading-projects" title="Direct link to heading">​</a></h2><p>TouchGFX Generator的相關參數儲存在CubeMX專案檔.ioc當中。 當發佈新版TouchGFX Generator時，舊版的參數可能與新版的參數不相容，此時便需要進行轉移（migration）。</p><p>CubeMX不支援X-CUBE版本之間的升級。而由於<code>.touchgfx</code>檔案內<code>PostGenerateTargetCommand</code>當中的指令（如下所示），因此在按下<em>產生代碼</em>時TouchGFX Designer會自動執行升級。</p><div class="code-header"><div><h5>.touchgfx</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PostGenerateTargetCommand&quot; : &quot;touchgfx update_project --project-file=../upgrade.ioc --platform=m7&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>這道指令將讀取<code>.ioc</code>檔並更新參數以適應X-CUBE-TOUCHGFX目前的版本。 由以下範例可以看到如何透過手動執行X-CUBE-TOUCHGFX 4.14.0的腳本（script）指令對X-CUBE-TOUCHGFX 4.13.0所建立的.ioc檔案進行升級。</p><div class="code-header"><div><h5>Upgrade example using STM32F746 DISCO Application Template from 4.13.0 to 4.14.0</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ touchgfx update_project --project-file=../STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TouchGFX Generator 4.13.0 found</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creating backup of ../STM32F746G_DISCO.ioc as ../backup_STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Performing upgrade 4.13.0 -&gt; 4.14.0 ... OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>以CubeMX開啟升級過的專案時CubeMX會提示使用者要安裝.ioc檔所指定的X-CUBE-TOUCHGFX版本（若指定版本尚未安裝的情況下）。 點選<em>立即下載（Download now）</em>後將下載並安裝X-Cube-TouchGFX-4.14.0。</p><div class="figure"><a href="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.webp" target="_blank"><img src="/4.16/zh-TW/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.webp"></a><p>遺漏附加軟體：TouchGFX Generator 4.14.0</p></div><p>升級期間會保留TouchGFX Generator中的所有設定，.ioc檔的備份檔會以前置檔名<code>backup_</code>的方式放成原始檔旁。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">要使用TouchGFX Generator所提供的新功能必須在CubeMX中再執行<i>產生代碼（Generate Code）</i>。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">如果透過CubeMX（而不是透過TouchGFX Designer）來執行為現有的TouchGFX專案升級X-CUBE-TOUCHGFX，TouchGFX Generator參數將被重置為預設值。</div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">抽象層架構</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.16/zh-TW/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LTDC/並列RGB</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enabling-touchgfx-generator" class="table-of-contents__link toc-highlight">啟用TouchGFX Generator</a></li><li><a href="#generated-code-architecture" class="table-of-contents__link toc-highlight">產生程式碼的架構</a></li><li><a href="#feature-overview" class="table-of-contents__link toc-highlight">特性概述</a></li><li><a href="#display" class="table-of-contents__link toc-highlight">顯示（Display）</a><ul><li><a href="#interface-and-dimensions" class="table-of-contents__link toc-highlight">介面與尺寸</a></li><li><a href="#buffering-strategies" class="table-of-contents__link toc-highlight">緩衝區策略</a></li></ul></li><li><a href="#driver" class="table-of-contents__link toc-highlight">驅動程式</a><ul><li><a href="#application-tick-source" class="table-of-contents__link toc-highlight">應用時標源（Application Tick Source）</a></li><li><a href="#graphics-accelerator" class="table-of-contents__link toc-highlight">圖形加速器</a></li><li><a href="#real-time-operating-system" class="table-of-contents__link toc-highlight">即時作業系統</a></li><li><a href="#additional-features" class="table-of-contents__link toc-highlight">額外功能</a></li></ul></li><li><a href="#generated-project" class="table-of-contents__link toc-highlight">產生的專案</a></li><li><a href="#touchgfx-designer-project" class="table-of-contents__link toc-highlight">TouchGFX Designer專案</a></li><li><a href="#modifying-generated-behavior" class="table-of-contents__link toc-highlight">修改所產生的行為</a></li><li><a href="#upgrading-projects" class="table-of-contents__link toc-highlight">升級專案</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2021 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div>
<script src="/4.16/zh-TW/assets/js/runtime~main.eee51835.js"></script>
<script src="/4.16/zh-TW/assets/js/main.3ffa3542.js"></script>
</body>
</html>