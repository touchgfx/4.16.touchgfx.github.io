<!doctype html>
<html lang="zh-CN" dir="ltr" class="docs-wrapper docs-doc-page docs-version-current plugin-docs plugin-id-default docs-doc-id-development/touchgfx-hal-development/touchgfx-generator">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<meta name="generator" content="Docusaurus v2.0.1">
<link rel="search" type="application/opensearchdescription+xml" title="TouchGFX Documentation" href="/4.16/zh-CN/opensearch.xml">
<script src="/4.16/zh-CN/js/one-trust.js"></script>
<script src="/4.16/js/fix-location.js"></script><title data-rh="true">Generator用户指南 | TouchGFX Documentation</title><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://support.touchgfx.com/4.16/zh-CN/img/meta-image.png"><meta data-rh="true" name="twitter:image" content="https://support.touchgfx.com/4.16/zh-CN/img/meta-image.png"><meta data-rh="true" property="og:url" content="https://support.touchgfx.com/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator"><meta data-rh="true" name="docusaurus_locale" content="zh-CN"><meta data-rh="true" name="docsearch:language" content="zh-CN"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Generator用户指南 | TouchGFX Documentation"><link data-rh="true" rel="icon" href="/4.16/zh-CN/img/favicon.png"><link data-rh="true" rel="canonical" href="https://support.touchgfx.com/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="en"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/ko/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ko"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/ja/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="ja"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-CN"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="zh-TW"><link data-rh="true" rel="alternate" href="https://support.touchgfx.com/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" hreflang="x-default"><link data-rh="true" rel="preconnect" href="https://B8LNOI0XWD-dsn.algolia.net" crossorigin="anonymous"><link rel="stylesheet" href="/4.16/zh-CN/assets/css/styles.d56efc44.css">
<link rel="preload" href="/4.16/zh-CN/assets/js/runtime~main.62e2f8b7.js" as="script">
<link rel="preload" href="/4.16/zh-CN/assets/js/main.b04983d7.js" as="script">
</head>
<body class="navigation-with-keyboard">
<script>!function(){function t(t){document.documentElement.setAttribute("data-theme",t)}var e=function(){var t=null;try{t=localStorage.getItem("theme")}catch(t){}return t}();t(null!==e?e:"light")}()</script><div id="__docusaurus">
<div><div role="region"><a href="#" class="skipToContent_fXgn">Skip to main content</a></div><nav class="navbar navbar--fixed-top"><div class="navbar__inner"><div class="navbar__items"><button aria-label="Navigation bar toggle" class="navbar__toggle clean-btn" type="button" tabindex="0"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" target="_self" href="/4.16/zh-CN/docs/introduction/welcome"><div class="navbar__logo"><img src="/4.16/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--light_HNdA"><img src="/4.16/zh-CN/img/logo.svg" alt="TouchGFX" class="themedImage_ToTc themedImage--dark_i4oU"></div></a><div class="navbar__item dropdown dropdown--hoverable"><a href="#" aria-haspopup="true" aria-expanded="false" role="button" class="navbar__link">简体中文</a><ul class="dropdown__menu"><li><a href="/4.16/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">English</a></li><li><a href="/4.16/ko/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">한국어</a></li><li><a href="/4.16/ja/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">日本語</a></li><li><a href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link dropdown__link--active">简体中文</a></li><li><a href="/4.16/zh-TW/docs/development/touchgfx-hal-development/touchgfx-generator" target="_self" rel="noopener noreferrer" class="dropdown__link">繁體中文</a></li></ul></div></div><div class="navbar__items navbar__items--right"><div class="navbar__item dropdown dropdown--hoverable dropdown--right"><a class="navbar__link" aria-haspopup="true" aria-expanded="false" role="button" href="/4.16/zh-CN/docs/introduction/welcome">4.16</a><ul class="dropdown__menu"><li><a aria-current="page" class="dropdown__link dropdown__link--active" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator">4.16</a></li><li><a href="https://support.touchgfx.com/4.15" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.15<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.14" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.14<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li><li><a href="https://support.touchgfx.com/4.13" target="_blank" rel="noopener noreferrer" class="dropdown__link">4.13<svg width="12" height="12" aria-hidden="true" viewBox="0 0 24 24" class="iconExternalLink_nPIU"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"></path></svg></a></li></ul></div><a href="https://community.st.com/s/topic/0TO0X0000003iw6WAA/touchgfx" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Community</a><a href="https://touchgfx.com/" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">TouchGFX.com</a><div class="searchBox_ZlJk"><button type="button" class="DocSearch DocSearch-Button" aria-label="Search"><span class="DocSearch-Button-Container"><svg width="20" height="20" class="DocSearch-Search-Icon" viewBox="0 0 20 20"><path d="M14.386 14.386l4.0877 4.0877-4.0877-4.0877c-2.9418 2.9419-7.7115 2.9419-10.6533 0-2.9419-2.9418-2.9419-7.7115 0-10.6533 2.9418-2.9419 7.7115-2.9419 10.6533 0 2.9419 2.9418 2.9419 7.7115 0 10.6533z" stroke="currentColor" fill="none" fill-rule="evenodd" stroke-linecap="round" stroke-linejoin="round"></path></svg><span class="DocSearch-Button-Placeholder">Search</span></span><span class="DocSearch-Button-Keys"></span></button></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div class="main-wrapper mainWrapper_z2l0 docsWrapper_BCFX"><button aria-label="回到顶部" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docPage__5DB"><aside class="theme-doc-sidebar-container docSidebarContainer_b6E3"><div class="sidebar_njMd"><nav class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/introduction/welcome">Introduction</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/basic-concepts/embedded-graphics">Basic Concepts</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" href="/4.16/zh-CN/docs/development/development-introduction">Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-CN/docs/development/development-introduction">开发简介</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-CN/docs/development/hardware-selection/hardware-selection-introduction">Hardware Selection</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-CN/docs/development/board-bring-up/board-introduction">Board Bring Up</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" aria-expanded="true" tabindex="0" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX AL Development</a></div><ul style="display:block;overflow:visible;height:auto" class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-al-development-introduction">TouchGFX开发简介</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link" tabindex="0" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-architecture">抽象层架构</a></li><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-3 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-generator">Generator用户指南</a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-3 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">Scenarios</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-CN/docs/development/ui-development/ui-development-introduction">UI Development</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-2 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" tabindex="0" href="/4.16/zh-CN/docs/development/scenarios/touchgfx-on-lowcost-hardware">Scenarios</a></div></li></ul></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/miscellaneous/updating-to-a-new-touchgfx-version">Miscellaneous</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/tutorials/tutorial-01">Tutorials</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/api/classes/classtouchgfx_1_1_abstract_button">API</a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="menu__link menu__link--sublist menu__link--sublist-caret" aria-expanded="false" href="/4.16/zh-CN/docs/resources/presentations">Resources</a></div></li></ul></nav></div></aside><main class="docMainContainer_gTbr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div id="doc-version-banner-identifier" class="theme-doc-version-banner alert alert--warning margin-bottom--md" role="alert"><div>This is documentation for <!-- -->TouchGFX Documentation<!-- --> <b>4.16</b>, which is no longer actively maintained.</div><div class="margin-top--md">For up-to-date documentation, see the <b><a href="/docs/development/touchgfx-hal-development/touchgfx-generator">latest version</a></b>.</div></div><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="页面路径"><ul class="breadcrumbs" itemscope="" itemtype="https://schema.org/BreadcrumbList"><li class="breadcrumbs__item"><span class="breadcrumbs__link">Development</span><meta itemprop="position" content="1"></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">TouchGFX AL Development</span><meta itemprop="position" content="2"></li><li itemscope="" itemprop="itemListElement" itemtype="https://schema.org/ListItem" class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link" itemprop="name">Generator用户指南</span><meta itemprop="position" content="3"></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">本页总览</button></div><div class="theme-doc-markdown markdown"><header><h1>Generator用户指南</h1></header><p>TouchGFX Generator是X-CUBE-TOUCHGFX的一部分，也是CubeMX附加软件组件，可帮助开发人员配置TouchGFX并运行于他的硬件平台上。 根据已有的CubeMX设置和用户输入，TouchGFX Generator将生成TouchGFX应用所需的有效配置文件。 这包括TouchGFX HAL、TouchGFX OSAL和TouchGFX配置文件。</p><p>通过CubeMX生成代码后，可通过开发UI的TouchGFX Designer打开TouchGFX项目。 TouchGFX Designer会自动将任何额外生成的代码文件添加到通过CubeMX所配置的目标IDE。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="enabling-touchgfx-generator">使能TouchGFX Generator<a class="hash-link" href="#enabling-touchgfx-generator" title="Direct link to heading">​</a></h2><p>下图显示了在<em>附加软件</em>类别中已使能TouchGFX Generator的项目。 用户可通过按“附加软件”按钮来访问X-CUBE的附加功能。</p><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/enable-generator.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/enable-generator.webp"></a><p>选择CubeMx中的附加软件</p></div><p>下图显示了项目中如何使能TouchGFX Generator：</p><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/add-generator.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/add-generator.webp"></a><p>使能TouchGFX Generator</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-code-architecture">生成的代码架构<a class="hash-link" href="#generated-code-architecture" title="Direct link to heading">​</a></h2><p>在描述TouchGFX Generator的功能之前，了解所生成代码的架构以及开发人员如何使用该架构来定制配置和行为至关重要。</p><p>通过巧妙使用分布在CubeMX生成的C代码中的<strong>用户代码</strong>段，为CubeMX生成的文件中的手动用户代码提供保护。在TouchGFX Generator生成的C++代码中，通过继承来实现这种灵活性。</p><p>通过<em>附加软件</em>添加TouchGFX Generator并使能后，CubeMX总是会为项目创建一个<em>TouchGFX</em>文件夹。 无论配置如何，该文件夹总是包含相同的文件，而文件内容则因CubeMX和用户配置而异。</p><p>以下列表概述了<em>使能</em>TouchGFX Generator的CubeMX项目内容，并重点介绍与TouchGFX有关的文件。 下面按列表概述了最重要条目的功能。</p><div class="code-header"><div><h5>TouchGFX Folder</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   .mxproject</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">│   myproject.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Core</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Drivers</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───EWARM</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">├───Middlewares</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">└───TouchGFX</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │   ApplicationTemplate.touchgfx.part</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    ├───App</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.c</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    │       app_touchgfx.h</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    └───target</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   STM32TouchController.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXGPIO.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │   TouchGFXHAL.hpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        │</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">        └───generated</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                OSWrappers.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXConfiguration.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.cpp</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">                TouchGFXGeneratedHAL.hpp</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><table><thead><tr><th>文件夹</th><th>职责</th></tr></thead><tbody><tr><td>myproject.ioc</td><td>CubeMX项目文件</td></tr><tr><td>内核</td><td><code>main.c</code>和启动代码</td></tr><tr><td>驱动</td><td>CMSIS和MCU系列驱动程序</td></tr><tr><td>EWARM</td><td>IDE项目文件夹。 可以为EWARM、MDK-ARM或STM32CubeIDE</td></tr><tr><td>中间件</td><td>包含TouchGFX库/头文件以及FreeRTOS等第三方软件。</td></tr><tr><td>ApplicationTemplate.touchgfx.part</td><td>CubeMX使用与TouchGFX Designer项目相关的信息（如屏幕尺寸和位深）来更新.part文件</td></tr><tr><td>应用</td><td>X-CUBE interface to CubeMX. <code>app_touchgfx.c</code> contains definitions for the functions <code>MX_TouchGFX_Process(void)</code> and <code>MX_TouchGFX_Init(void)</code> which are used to initialize TouchGFX and start its main loop.</td></tr><tr><td>目标/生成</td><td>该子文件夹包含只读文件，当配置更改时，这些文件会被CubeMX覆盖。 <code>TouchGFXGeneratedHAL.cpp</code>是TouchGFX类<code>HAL</code>的子类，并包含CubeMX基于其当前配置生成的代码。 <code>OSWrappers.cpp</code>(OSAL) 包含与TouchGFX Engine同步所需的功能，最后是<code>TouchGFXConfiguration.cpp</code>，其包含用于构建和配置TouchGFX的代码，包括HAL。</td></tr><tr><td>目标</td><td>包含大量文件，用户可修改这些文件，以扩展HAL行为，或覆盖CubeMX生成的配置。 <code>STM32TouchController.cpp</code>包含触摸控制器操作的空接口。 <code>TouchGFXHAL.cpp</code>定义<code>TouchGFXGeneratedHAL</code>的子类<code>TouchGFXHAL</code>。</td></tr></tbody></table><p>需要注意的是，<code>TouchGFXConfiguration.cpp</code>包含一个用于构建HAL的函数以及一个用于启动TouchGFX主循环的函数。 可在可编辑的用户类<code>TouchGFXHAL</code>中完成其他配置。 HAL的一般架构如下所示：</p><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/code-architecture.webp" target="_blank"><img width="200" src="/4.16/zh-CN/img/development/touchgfx-hal-development/code-architecture.webp"></a><p>生成的代码的层次结构</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="feature-overview">特性概述<a class="hash-link" href="#feature-overview" title="Direct link to heading">​</a></h2><p>使能TouchGFX Generator后，用户界面中存在三个组：</p><ul><li><strong><em>依赖关系</em></strong>- 该组包含针对开关人员的有关配置中的依赖关系、警告或具体错误的通知。 如果没有条目，则该组将隐藏。</li><li><strong><em>显示</em></strong>- 该组包含与显示有关的设置，如接口、帧缓存的位深、宽度和高度。 这些设置直接影响TouchGFX项目里画布的大小以及基于显示部件所生成的代码。</li><li><strong><em>驱动程序</em></strong>- 该组允许用户选择与应用相关的滴答计时源、图形加速和RTOS有关的一些现成驱动程序。 由于CubeMX支持FreeRTOS（CMSIS RTOS v1和v2）配置，TouchGFX Generator为每个选项提供了驱动程序。</li></ul><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/three-sections.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/three-sections.webp"></a><p>TouchGFX Generator有三个组：依赖关系、显示、驱动程序</p></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="display">显示<a class="hash-link" href="#display" title="Direct link to heading">​</a></h2><p><em>显示</em>组包含与显示有关的配置，如接口、尺寸和缓冲策略。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="interface-and-dimensions">接口与尺寸<a class="hash-link" href="#interface-and-dimensions" title="Direct link to heading">​</a></h3><p>如今，STM32微控制器可使用多个显示接口，如：</p><ul><li>并行RGB</li><li>MIPI DSI</li><li>FMC</li><li>SPI</li></ul><p>对于带有LTDC的MCU，<em>TouchGFX Generator</em>可生成驱动程序，以将帧缓冲内容传输到相连接的显示器。 对于DSI、FMC和SPI接口，驱动程序必须由开发人员自己实现。</p><div class="highlight highlight-further-reading"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M7 2.3c3.14 0 5.7 2.56 5.7 5.7s-2.56 5.7-5.7 5.7A5.71 5.71 0 0 1 1.3 8c0-3.14 2.56-5.7 5.7-5.7zM7 1C3.14 1 0 4.14 0 8s3.14 7 7 7 7-3.14 7-7-3.14-7-7-7zm1 3H6v5h2V4zm0 6H6v2h2v-2z"></path></svg></div>Further reading</h5></div><div class="highlight-content">有关不同显示界面的驱动程序具体事例，请参见<a href="/4.16/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb">方案</a>章节。</div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="buffering-strategies">缓冲策略<a class="hash-link" href="#buffering-strategies" title="Direct link to heading">​</a></h3><p>可通过TouchGFX Generator配置以下帧缓冲策略：</p><ul><li><strong>单帧缓冲</strong> - 仅使用一个应用帧缓冲区。 可能会使性能受限，但占用内存更少。 可与“缓冲位置”配置一起使用，将其放置在内部RAM中。 为进一步优化，用户可以定义一个函数，该函数返回显示控制器正在处理的当前行。 该方法用于框架，以允许更新该帧期间已传输到显示屏的内存。</li><li><strong>双缓冲</strong> - 使用两个帧缓冲区。 通常以牺牲内存为代价来获得更好的性能。</li><li><strong>部分缓冲</strong>- 将一个或多个用户定义的内存块作为帧缓冲区。 该策略适用于低成本解决方案，它不依赖外部RAM但可以实现超出可用内存的全帧缓冲能力。</li></ul><p>对于单缓冲区和双缓冲区，用户可通过“缓冲器位置”来配置其位置，该配置提供以下选项：</p><ul><li><strong>按分配</strong>- 允许链接器根据链接器脚本来放置帧缓冲存储器。 默认位于内部RAM中。</li><li><strong>按地址</strong>- 允许用户定义一个(单) 或两个(双) 帧缓冲地址。</li></ul><p><strong>部分帧缓冲</strong>策略允许用户定义以下参数:</p><ul><li>块数（始终放置在内部RAM中）</li><li>块大小（字节）</li></ul><p>要了解有关部分缓冲战略的一些核心概念，请阅读使用部分帧缓冲区降低内存要求的<a href="/4.16/zh-CN/docs/development/scenarios/lowering-memory-usage-with-partial-framebuffer">专用文章</a>。 本文从概念上说明了如何实现部分帧缓冲，并且本文中显示的代码与TouchGFX Generator生成的代码略有不同。 有关为这些策略生成的具体示例代码，请参见<a href="/4.16/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-framebuffer-strategies">帧缓冲策略</a>。</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="driver">驱动器<a class="hash-link" href="#driver" title="Direct link to heading">​</a></h2><p>驱动器部分允许开发人员为TouchGFX AL的各种功能选择驱动程序。</p><h3 class="anchor anchorWithStickyNavbar_LWe7" id="application-tick-source">应用滴答计时源<a class="hash-link" href="#application-tick-source" title="Direct link to heading">​</a></h3><p>滴答计时源定义了如何展开驱动应用程序的开发。 开发人员具有以下选项：</p><ul><li><strong>LTDC</strong>- 如果在“显示”组中将LTDC选作接口，则应用计时源可以为“LTDC”。 这意味着TouchGFX Generator将在<code>TouchGFXGenerated HAL</code>类中安装驱动程序函数(LTDC中断处理程序) ，该函数通过调用<code>OSWrappers::signalVSync()</code>来展开驱动应用程序。</li><li><strong>定制</strong>- 在这种情况下，开发人员通过重复调用<code>OSWrappers::signalVSync()</code>来实现驱动应用程序。</li></ul><h3 class="anchor anchorWithStickyNavbar_LWe7" id="graphics-accelerator">图形加速器<a class="hash-link" href="#graphics-accelerator" title="Direct link to heading">​</a></h3><p>对于图形加速，开发人员有三个选项：</p><ul><li><strong>无</strong> - 应用程序仅使用CPU来绘制frames.</li><li><strong>Chrom-ART (DMA2D)</strong>- 应用程序在可能的情况下使用Chrom-ART芯片来移动和混合像素，释放CPU。 驱动程序由TouchGFX Generator安装，不需要开发人员采取任何措施。</li></ul><ol><li>Uses the STM32Cube HAL driver where it registers a callback funtion to the dma2d handle <code>hdma2d.XferCpltCallback</code>.</li><li>Uses the <code>DMA2D_IRQHandler()</code> interrupt handler directly.</li></ol><p>Switching between these two is done by enabling or disabling the DMA2D global interrupt in the NVIC Settings in CubeMX for DMA2D IP. Enabling the global interrupt generated code for option 1), disabling the global interrupt generates code for option 2).</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content"><li>When using global interrupt for DMA2D, ensure that the &quot;IRQ handler&quot; calls the &quot;DMA2D HAL handler&quot;, this is default behaviour.</li><li>If disabling &quot;IRQ handler&quot; and &quot;Call HAL handler&quot; for DMA2D while global interrupt is enabled will cause the registered callback to never be called.</li></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="real-time-operating-system">实时操作系统<a class="hash-link" href="#real-time-operating-system" title="Direct link to heading">​</a></h3><p>开发人员可使用任何支持TouchGFX的RTOS（甚至无操作系统）。 如抽象层架构中所述，TouchGFX Engine使用<code>OSWrappers</code>接口将其主事件循环以及帧缓冲访问与用户选择的RTOS同步。</p><p>可直接在CubeMX中配置FreeRTOS，TouchGFX Generator允许用户为任务的定义和TouchGFX RTOS驱动程序生成代码。 TouchGFX Generator可生成兼容CMSIS V1和CMSIS V2的RTOS驱动程序，该驱动程序可用于兼容CMSIS的任何RTOS。 在这种情况下，开发人员无法依赖CubeMX生成任务定义代码，必须在<em>用户代码</em>中完成。</p><p>下图显示了通过TouchGFX Generator可用的选项。</p><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options.webp" target="_blank"><img width="675" src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/driver-rtos-options.webp"></a><p>RTOS驱动程序选项</p></div><p>调用以下函数时，将进入TouchGFX主循环。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>开发人员需要在任务处理程序中为要在其中运行TouchGFX应用程序的任务调用此函数。 如果用户从CubeMX配置了名为<code>DefaultTask</code>的FeeRTOS任务，则以下示例显示了如何调用<code>MX_TouchGFX_Process()</code>，以启动其任务处理程序的用户代码部分中的TouchGFX。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">StartDefaultTask</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">*</span><span class="token plain">argument</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE BEGIN 5 */</span><span class="token plain"></span><br></span><span class="token-line theme-code-block-highlighted-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* USER CODE END 5 */</span><span class="token plain"> </span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使能FreeRTOS时，CubeMX还将调用<code>osKernelStart()</code>启动调度器。</p><h4 class="anchor anchorWithStickyNavbar_LWe7" id="other-cmsis-compliant-os">其他兼容CMSIS的OS<a class="hash-link" href="#other-cmsis-compliant-os" title="Direct link to heading">​</a></h4><p>当开发人员采用与CubeMX提供的操作系统（FreeRTOS）不同的其他兼容CMSIS的操作系统时，他必须手动完成RTOS配置和任务定义。 通常，需要执行以下手动步骤：</p><ol><li>配置RTOS</li><li>定义任务以运行TouchGFX (<code>MX_TouchGFX_Process</code>)</li><li>启动调度器</li></ol><p>以下是如何对<em>Azure RTOS</em>执行步骤2和3的示例。 由于CubeMX无法为此进行任何配置，因此必须在提供的<em>用户代码部分</em>中执行所有操作，以免代码被覆盖。 以下代码显示了GUI任务定义的伪代码。 通常，任何不是由CubeMX生成的代码均应放在分散于整个<code>main.c</code>文件中的<em>用户代码部分</em>。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">include</span><span class="token macro property"> </span><span class="token macro property string" style="color:rgb(195, 232, 141)">&quot;tx_api.h&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token macro property directive-hash">#</span><span class="token macro property directive keyword" style="font-style:italic">define</span><span class="token macro property"> </span><span class="token macro property macro-name">GUI_THREAD_STACK_SIZE</span><span class="token macro property">         </span><span class="token macro property expression number" style="color:rgb(247, 140, 108)">1024</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">TX_THREAD gui_thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain">    </span><span class="token function" style="color:rgb(130, 170, 255)">gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ULONG thread_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"> </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Thread prototype</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">int</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">main</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION - Choose an appropriate one from main.c */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Allocate the stack for gui thread  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">tx_byte_allocate</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* Create the gui thread.  */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">tx_thread_create</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token operator" style="color:rgb(137, 221, 255)">&amp;</span><span class="token plain">gui_thread</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;GUI Thread&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">0</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              pointer</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> GUI_TASK_STACK_SIZE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">              </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">1</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_NO_TIME_SLICE</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"> TX_AUTO_START</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>调用<code>MX_TouchGFX_Process</code>，以启动任务处理程序中的TouchGFX Engine主循环。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token function" style="color:rgb(130, 170, 255)">gui_thread_entry</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token plain">ULONG thread_input</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token function" style="color:rgb(130, 170, 255)">MX_TouchGFX_Process</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>启动调度器，以启动GUI任务和您的TouchGFX应用。</p><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* BEGIN USER CODE SECTION */</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token function" style="color:rgb(130, 170, 255)">tx_kernel_enter</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">/* END USER CODE SECTION*/</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h3 class="anchor anchorWithStickyNavbar_LWe7" id="additional-features">其它功能<a class="hash-link" href="#additional-features" title="Direct link to heading">​</a></h3><h4 class="anchor anchorWithStickyNavbar_LWe7" id="external-data-reader">外部数据读取器<a class="hash-link" href="#external-data-reader" title="Direct link to heading">​</a></h4><p>对于RGB565帧缓冲像素格式，touchgfx支持所谓的<em>数据读取器</em>接口，该接口使开发人员能够直接从非存储器映射串行闪存读取数据，而无需进行<a href="/4.16/zh-CN/docs/development/ui-development/touchgfx-engine-features/caching-bitmaps">缓存</a>，当然这需要增加额外的缓冲存储区。 有关如何实现DataReader，从非存储映射闪存芯片中获取应用程序资源的示例，请参见<a href="/4.16/zh-CN/docs/development/scenarios/using-serial-flash">SerialFlash</a>文章。</p><p><em>数据读取器</em>选项通常用于没有足够的内存用于额外缓冲区的低成本解决方案(如STM32G0) 。 如果DMA2D使能了，则无法使能该选项。</p><p>一旦<em>RGB565</em>选作帧缓冲像素格式后，<em>附加功能</em>组将变得可用。</p><div class="figure noshadow"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.webp" target="_blank"><img width="520" src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/additional-features-data-reader.webp"></a><p>其它功能：数据读取器</p></div><p>开发人员可进行以下配置：</p><ul><li><strong>外部数据读取器：</strong>使能或禁用功能。 如果使能，TouchGFX将直接通过生成的接口检索应用资源。 如果禁用，则开发人员需要将图片资源<em>缓存</em>到内存缓冲区中。</li><li><strong>外部数据读取器：行缓冲区大小：</strong>创建两个缓冲区，以便将图像或文本混合到帧缓冲中。 默认值为一个屏幕宽度*4字节，以支持ARGB8888像素格式的全尺寸图像。</li><li><strong>外部数据读取器：最小DMA传输大小：</strong>设置启动DMA传输所需的最小字节。 如果请求传输的字节更少，将不使用DMA。</li></ul><p>在使能<em>外部数据读取器</em>的情况下生成代码后，将创建以下附加文件，以支持直接从非存储器映射闪存中检索图片资源。</p><ul><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedDataReader.hpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.cpp</code></li><li><code>TouchGFX/target/TouchGFXDataReader.hpp</code></li></ul><p>像往常一样，对于TouchGFX Generator生成的代码，<code>TouchGFXGeneratedDataReader</code>为只读，用户修改应在<code>TouchGFXDataReader</code>类中进行。 <code>TouchGFXGeneratedDataReader</code>的类型为<code>touchgfx::FlashDataReader</code>。</p><p>将TouchGFX HAL配置为使用<code>DataReader</code>，并对以下文件进行修改。</p><ul><li><code>TouchGFX/target/generated/TouchGFXConfiguration.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.cpp</code></li><li><code>TouchGFX/target/generated/TouchGFXGeneratedHAL.hpp</code></li></ul><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">仅当禁用DMA2D和LTDC时，DataReader附加功能才可用。</div></div><h4 class="anchor anchorWithStickyNavbar_LWe7" id="8bit-ltdc-color-look-up-table">8bit LTDC Color Look-up Table<a class="hash-link" href="#8bit-ltdc-color-look-up-table" title="Direct link to heading">​</a></h4><p>When the LTDC is configured to read the framebuffer in L8 format and TouchGFX renders in either <a href="/4.16/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___a_b_g_r2222">ABRG2222</a>, <a href="/4.16/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___a_r_g_b2222">ARGB222</a>, <a href="/4.16/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___b_g_r_a2222">BGRA2222</a>, or <a href="/4.16/zh-CN/docs/api/classes/classtouchgfx_1_1_l_c_d8bpp___r_g_b_a2222">RGBA2222</a>, TouchGFX Generator will provide a CLUT which is loaded into the LTDC during <code>TouchGFXHAL::initialize()</code>. Please refer to the STM32 MCU reference manual for more details on usage of LTDC and CLUT.</p><h2 class="anchor anchorWithStickyNavbar_LWe7" id="generated-project">生成的项目<a class="hash-link" href="#generated-project" title="Direct link to heading">​</a></h2><p>使用CubeMX中的<strong>生成代码</strong>按钮生成代码时，TouchGFX(至少) 适用于以下IDE:</p><ol><li>EWARM</li><li>MDK-ARM</li><li>STM32CubeIDE</li></ol><p>要获得最优项目结构，请选择以下项目生成选项：</p><ul><li>应用结构：<strong>高级</strong></li><li>禁用<strong>在根下生成</strong>(仅限STM32CubeIDE)</li></ul><p>要获得最优项目结构，请选择以下项目生成选项：</p><ul><li>应用结构：<strong>高级</strong></li><li>禁用<strong>在根下生成</strong>(仅限STM32CubeIDE)</li></ul><div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/project-manager.webp"></a><p>选择“高级应用结构”，然后取消选择“在根下生成”</p></div> CubeMX还将生成具有以下结构的*TouchGFX*文件夹:<div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/folder-b.webp"></a><p>TouchGFX文件夹结构</p></div><ul><li><em>应用</em>文件夹，包含用于初始化和启动TouchGFX的代码。</li><li><em>目标</em>文件夹，包含生成的只读代码(在内部生成) 和可更改的用户类(<code>STM32TouchController.cpp</code>、<code>TouchGFXGPIO.cpp</code>和<code>TouchGFXHAL.cpp</code>)</li><li><em>.part</em>文件，使用TouchGFX Designer来打开，以便创建完整的TouchGFX项目，其中包括TouchGFX头文件和库。part文件包含设计人员在生成TouchGFX应用程序代码时使用的相关程序信息，如像素格式和屏幕尺寸。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="touchgfx-designer-project">TouchGFX Designer项目<a class="hash-link" href="#touchgfx-designer-project" title="Direct link to heading">​</a></h2><p>以下代码是在<a href="#generated-code-architecture">生成的代码架构</a>章节中提到的<code>.part</code>文件内容示例。 当TouchGFX Designer创建新文件（如新屏幕和图片资源）时，后生成命令（如下所示）将更新CubeMX中选择的项目（如EWARM）。</p><div class="language-json codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-json codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Application&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Name&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;my_project&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;TouchGfxPath&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;../Middlewares/ST/touchgfx&quot;</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableColorDepths&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">16</span><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableLCDs&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;16&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;LCD16bpp&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;AvailableResolutions&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">[</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Width&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">320</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token property">&quot;Height&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token number" style="color:rgb(247, 140, 108)">240</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">]</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;PostGenerateTargetCommand&quot;</span><span class="token plain"> </span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;touchgfx update_project --project-file=../my_project.ioc --platform=m7&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><span class="token punctuation" style="color:rgb(199, 146, 234)">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"> </span><span class="token property">&quot;Version&quot;</span><span class="token operator" style="color:rgb(137, 221, 255)">:</span><span class="token plain"> </span><span class="token string" style="color:rgb(195, 232, 141)">&quot;4.13.0&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用TouchGFX Designer打开<em>.part</em>文件时，开发人员可以选择加载现存UI或从空白模板开始。</p><div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/choose-ui.webp"></a><p>选择UI</p></div><p>按下TouchGFX Designer中的<em>生成代码</em>后，TouchGFX文件夹的结构如下所示。 下图显示了TouchGFX文件夹结构的具体示例，并着重显示了生成后的新文件及文件夹。</p><div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/designer-gen-code.webp"></a><p>生成代码</p></div><div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/post-designer-generation.webp"></a><p>TouchGFX文件夹结构</p></div><p>TouchGFX将从.ioc CubeMX文件（适用于STM32CubeIDE、EWARM、MDK-ARM）中检测所选的IDE，并使用新生成的文件（如用于屏幕定义、图像和字体的文件）来更新项目。</p><p>此时，开发人员可以切换使用CubeMX、TouchGFX Designer和工具链/IDE，其中：</p><ul><li>CubeMX可以更新IDE项目中的驱动程序</li><li>CubeMX使用UI相关更改来更新TouchGFX<em>.part</em>文件，设计工具可以立即获取这些更改</li><li>CubeMX基于TouchGFX在特定平台所需的TouchGFX Generator配置来生成HAL代码（TouchGFX/target/generated/）。</li><li>TouchGFX Designer使用生成的代码来更新项目。</li></ul><h2 class="anchor anchorWithStickyNavbar_LWe7" id="modifying-generated-behavior">修改生成文件<a class="hash-link" href="#modifying-generated-behavior" title="Direct link to heading">​</a></h2><p>需要注意的是，由于HAL的类层次结构，用户可以无视CubeMX生成的HAL配置或操作。 在以下示例中，开发人员可以修改<code>初始化</code>函数，以额外配置TouchGFX，或修改<code>TouchGFXGeneratedHAL</code>中现有的配置集。</p><div class="code-header"><div><h5>TouchGFXHAL.cpp</h5></div></div><div class="language-cpp codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-cpp codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token keyword" style="font-style:italic">void</span><span class="token plain"> </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Calling parent implementation of initialize().</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// To overwrite the generated implementation, omit call to parent function</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// and implemented needed functionality here.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">// Please note, HAL::initialize() must be called to initialize the framework.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token class-name" style="color:rgb(255, 203, 107)">TouchGFXGeneratedHAL</span><span class="token double-colon punctuation" style="color:rgb(199, 146, 234)">::</span><span class="token function" style="color:rgb(130, 170, 255)">initialize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    </span><span class="token comment" style="color:rgb(105, 112, 152);font-style:italic">//Overriding configurations</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">lockDMAToFrontPorch</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token boolean" style="color:rgb(255, 88, 116)">true</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token function" style="color:rgb(130, 170, 255)">setFingerSize</span><span class="token punctuation" style="color:rgb(199, 146, 234)">(</span><span class="token number" style="color:rgb(247, 140, 108)">4</span><span class="token punctuation" style="color:rgb(199, 146, 234)">)</span><span class="token punctuation" style="color:rgb(199, 146, 234)">;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">    hal</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token punctuation" style="color:rgb(199, 146, 234)">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain"></span><span class="token punctuation" style="color:rgb(199, 146, 234)">}</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><h2 class="anchor anchorWithStickyNavbar_LWe7" id="upgrading-projects">升级项目<a class="hash-link" href="#upgrading-projects" title="Direct link to heading">​</a></h2><p>TouchGFX Generator参数存储在.ioc文件中（CubeMX项目）。 当发布新版TouchGFX Generator时，旧版的参数可能与新版的参数不兼容，并可能需要移植。</p><p>由于cubeMX不支持X-CUBE版本之间的升级，因此，基于<code>.touchgfx</code>文件的<code>PostGenerateTargetCommand</code>部分中的以下命令，当按下<em>生成代码</em>时，将通过TouchGFX Designer自动执行升级。</p><div class="code-header"><div><h5>.touchgfx</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">&quot;PostGenerateTargetCommand&quot; : &quot;touchgfx update_project --project-file=../upgrade.ioc --platform=m7&quot;</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>该命令将读取<code>.ioc</code>文件并更新参数，以适应X-CUBE-TOUCHGFX的当前版本。 以下是通过X-CUBE-TOUCHGFX 4.13.0创建的.ioc文件上手动运行脚本（X-CUBE-TOUCHGFX 4.14.0）的示例。</p><div class="code-header"><div><h5>使用STM32F746 DISCO应用模板从4.13.0升级到4.14.0的示例</h5></div></div><div class="codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#bfc7d5;--prism-background-color:#292d3e"><div class="codeBlockContent_biex"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#bfc7d5"><span class="token plain">$ touchgfx update_project --project-file=../STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  TouchGFX Generator 4.13.0 found</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Creating backup of ../STM32F746G_DISCO.ioc as</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">../backup_STM32F746G_DISCO.ioc</span><br></span><span class="token-line" style="color:#bfc7d5"><span class="token plain">  Performing upgrade 4.13.0 -&gt; 4.14.0 ... OK</span><br></span></code></pre><div class="buttonGroup__atx"><button type="button" aria-label="Copy code to clipboard" title="复制" class="clean-btn"><span class="copyButtonIcons_eSgA" aria-hidden="true"><svg class="copyButtonIcon_y97N" viewBox="0 0 24 24"><path d="M19,21H8V7H19M19,5H8A2,2 0 0,0 6,7V21A2,2 0 0,0 8,23H19A2,2 0 0,0 21,21V7A2,2 0 0,0 19,5M16,1H4A2,2 0 0,0 2,3V17H4V3H16V1Z"></path></svg><svg class="copyButtonSuccessIcon_LjdS" viewBox="0 0 24 24"><path d="M21,7L9,19L3.5,13.5L4.91,12.09L9,16.17L19.59,5.59L21,7Z"></path></svg></span></button></div></div></div><p>使用CubeMX打开更新过的项目时，系统会提示用户安装.ioc文件代表的X-CUBE-TOUCHGFX版本（如果尚未安装）。 点击<em>立即下载</em>后将下载并安装X-Cube-TouchGFX-4.14.0。</p><div class="figure"><a href="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.webp" target="_blank"><img src="/4.16/zh-CN/img/development/touchgfx-hal-development/touchgfx-generator/cubemx-additional-software-manager-settings-missing-x-cube-touchgfx-4.14.0.webp"></a><p>缺失的其他软件组件：TouchGFX Generator 4.14.0</p></div><p>升级期间将保留TouchGFX Generator中的所有配置，.ioc文件的备份文件将被放在原始文件旁，并带有前缀<code>backup_</code>。</p><div class="highlight highlight-note"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="14" height="16" viewBox="0 0 14 16"><path fill-rule="evenodd" d="M6.3 5.69a.942.942 0 0 1-.28-.7c0-.28.09-.52.28-.7.19-.18.42-.28.7-.28.28 0 .52.09.7.28.18.19.28.42.28.7 0 .28-.09.52-.28.7a1 1 0 0 1-.7.3c-.28 0-.52-.11-.7-.3zM8 7.99c-.02-.25-.11-.48-.31-.69-.2-.19-.42-.3-.69-.31H6c-.27.02-.48.13-.69.31-.2.2-.3.44-.31.69h1v3c.02.27.11.5.31.69.2.2.42.31.69.31h1c.27 0 .48-.11.69-.31.2-.19.3-.42.31-.69H8V7.98v.01zM7 2.3c-3.14 0-5.7 2.54-5.7 5.68 0 3.14 2.56 5.7 5.7 5.7s5.7-2.55 5.7-5.7c0-3.15-2.56-5.69-5.7-5.69v.01zM7 .98c3.86 0 7 3.14 7 7s-3.14 7-7 7-7-3.12-7-7 3.14-7 7-7z"></path></svg></div>Note</h5></div><div class="highlight-content">要使用TouchGFX Generator提供的新功能，必须在CubeMX中执行<i>生成代码</i>。</div></div><div class="highlight highlight-caution"><div class="highlight-heading"><h5><div class="highlight-icon"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M8.893 1.5c-.183-.31-.52-.5-.887-.5s-.703.19-.886.5L.138 13.499a.98.98 0 0 0 0 1.001c.193.31.53.501.886.501h13.964c.367 0 .704-.19.877-.5a1.03 1.03 0 0 0 .01-1.002L8.893 1.5zm.133 11.497H6.987v-2.003h2.039v2.003zm0-3.004H6.987V5.987h2.039v4.006z"></path></svg></div>Caution</h5></div><div class="highlight-content">如果通过CubeMX为现有的TouchGFX项目升级X-CUBE-TOUCHGFX，升级过程并非通过TouchGFX Designer来运行，TouchGFX Generator参数将被重置为默认值，因为它们要适用于不同版本。</div></div></div></article><nav class="pagination-nav docusaurus-mt-lg" aria-label="Docs pages navigation"><a class="pagination-nav__link pagination-nav__link--prev" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/touchgfx-architecture"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">抽象层架构</div></a><a class="pagination-nav__link pagination-nav__link--next" href="/4.16/zh-CN/docs/development/touchgfx-hal-development/scenarios/scenarios-ltdc-parallel-rgb"><div class="pagination-nav__sublabel">Next</div><div class="pagination-nav__label">LTDC/并行RGB</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#enabling-touchgfx-generator" class="table-of-contents__link toc-highlight">使能TouchGFX Generator</a></li><li><a href="#generated-code-architecture" class="table-of-contents__link toc-highlight">生成的代码架构</a></li><li><a href="#feature-overview" class="table-of-contents__link toc-highlight">特性概述</a></li><li><a href="#display" class="table-of-contents__link toc-highlight">显示</a><ul><li><a href="#interface-and-dimensions" class="table-of-contents__link toc-highlight">接口与尺寸</a></li><li><a href="#buffering-strategies" class="table-of-contents__link toc-highlight">缓冲策略</a></li></ul></li><li><a href="#driver" class="table-of-contents__link toc-highlight">驱动器</a><ul><li><a href="#application-tick-source" class="table-of-contents__link toc-highlight">应用滴答计时源</a></li><li><a href="#graphics-accelerator" class="table-of-contents__link toc-highlight">图形加速器</a></li><li><a href="#real-time-operating-system" class="table-of-contents__link toc-highlight">实时操作系统</a></li><li><a href="#additional-features" class="table-of-contents__link toc-highlight">其它功能</a></li></ul></li><li><a href="#generated-project" class="table-of-contents__link toc-highlight">生成的项目</a></li><li><a href="#touchgfx-designer-project" class="table-of-contents__link toc-highlight">TouchGFX Designer项目</a></li><li><a href="#modifying-generated-behavior" class="table-of-contents__link toc-highlight">修改生成文件</a></li><li><a href="#upgrading-projects" class="table-of-contents__link toc-highlight">升级项目</a></li></ul></div></div></div></div></main></div></div><footer class="footer"><div class="container container-fluid"><div class="footer__bottom text--center"><div class="footer__copyright">All rights reserved © 2021 STMicroelectronics | <a href="https://www.st.com/content/st_com/en/common/terms-of-use.html">Terms of use</a> | <a href="https://www.st.com/content/st_com/en/common/privacy-policy.html">Privacy Policy</a> | <a href="/docs/miscellaneous/cookie-policy">Cookie Policy</a> | <a href="https://app-de.onetrust.com/app/#/webform/2b87200d-4023-4588-9df7-ab0cdea1a67e">Exercise your rights</a></div></div></div></footer></div></div>
<script src="/4.16/zh-CN/assets/js/runtime~main.62e2f8b7.js"></script>
<script src="/4.16/zh-CN/assets/js/main.b04983d7.js"></script>
</body>
</html>